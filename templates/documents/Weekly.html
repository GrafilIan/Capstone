{% extends 'base.html' %}
{% load static %}

{% block title %}Weekly Report Panel{% endblock %}

{% block head %}

    <link rel="stylesheet" href="{% static 'style/Weekly.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

{% endblock %}

{% block content %}

    <div class="container-fluid">
        <div class="dash-content">
            <div class="title">
                <i class='bx bxs-report' ></i>
                <span class="text">NARRATIVE REPORT</span>
            </div>

            <div class="box"></div>

            <!-----PREVIEW BOX-->
            <div class="preview-box">
                <img src="preview-image.jpg" alt="Preview Image">
                <h2>Preview Title</h2>
                <p>Some preview content goes here.</p>
                <a href="#">Read More</a>
            </div>

            <!-----Forms---->
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    <label for="document_submission">Upload Document</label>
                    <input type="file" name="document_submission" id="document_submission" class="form-control-file">
                </div>
                <div class="form-group">
                    <label for="Weekly_textsub">Weekly Report Text</label>
                    <textarea name="Weekly_textsub" id="Weekly_textsub" class="form-control"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Upload</button>
            </form>

            <!-- Create a text editor div with contenteditable attribute for rich text editing -->
            <div class="text-editor" contenteditable="true" id="editor">
                Start typing here...
            </div>

            <!-- Create a toolbar with buttons for formatting -->
            <div class="merge">
                <div class="toolbar">
                    <button onclick="document.execCommand('bold', false, null);"><i class="fas fa-bold"></i></button>
                    <button onclick="document.execCommand('italic', false, null);"><i class="fas fa-italic"></i></button>
                    <button onclick="document.execCommand('underline', false, null);"><i class="fas fa-underline"></i></button>
                    <button onclick="document.execCommand('justifyLeft', false, null);"><i class="fas fa-align-left"></i></button>
                    <button onclick="document.execCommand('justifyCenter', false, null);"><i class="fas fa-align-center"></i></button>
                    <button onclick="document.execCommand('justifyRight', false, null);"><i class="fas fa-align-right"></i></button>
                </div>
            </div>

            <!-- Create a submit button -->
            <div class="sub">
                <button onclick="submitText()">Submit</button>
            </div>

        </div>
    </div>
{% endblock %}

{% block scripts %}

<script>
    // Function to update the current week when the user selects a different week
    function changeWeek(selectedWeek) {
        const currentWeekElement = document.getElementById('current-week');
        currentWeekElement.textContent = selectedWeek;
    }

     function submitText() {
        // Get the text from the text editor
        var textData = document.getElementById('editor').innerHTML;

        // Prepare the data to be sent to the server
        var data = {
            Weekly_textsub: textData,
            csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value
        };

        // Send the data to the server using AJAX
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '{% url 'Weekly' %}', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.onload = function () {
            if (xhr.status === 200) {
                // Handle the success response if needed
                console.log('Text data submitted successfully');
            } else {
                // Handle any errors or failure
                console.error('Failed to submit text data');
            }
        };
        xhr.send(JSON.stringify(data));
    }
</script>

{% endblock %}
